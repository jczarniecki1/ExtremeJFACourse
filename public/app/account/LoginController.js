// Generated by CoffeeScript 1.7.1
(function() {
  angular.module('app').controller('LoginController', function($scope, $http, NotifierService, IdentityService, AuthService, $location, CachedCourse) {
    var signinUser, userActions;
    $scope.identity = IdentityService;
    signinUser = function() {
      return AuthService.authenticateUser($scope.username, $scope.password).then(function(response) {
        if (response != null ? response.success : void 0) {
          CachedCourse.query().$promise.then(function(collection) {
            var course, _i, _len, _ref, _results;
            _results = [];
            for (_i = 0, _len = collection.length; _i < _len; _i++) {
              course = collection[_i];
              if ((_ref = $scope.identity.currentUser) != null ? _ref.courses.any(function(x) {
                return x.id === course._id;
              }) : void 0) {
                _results.push(course.started = true);
              } else {
                _results.push(void 0);
              }
            }
            return _results;
          });
          return NotifierService.notify('You have successfully signed in!');
        } else {
          if (response != null ? response.reason : void 0) {
            return NotifierService.warning("Failed to log in. Wrong " + response.reason);
          } else {
            return NotifierService.error('Cannot log in. Request not accepted');
          }
        }
      });
    };
    $scope.signin = function() {
      if (!(($scope.username != null) || ($scope.password != null))) {
        $('[ng-model="username"]').trigger('change');
        $('[ng-model="password"]').trigger('change');
        return setTimeout(signinUser, 100);
      } else {
        return signinUser();
      }
    };
    userActions = $('#userActions');
    userActions.find('.dropdown-toggle').click(function() {
      return userActions.toggleClass('open');
    });
    return $scope.signout = function() {
      return AuthService.logoutUser().then(function() {
        $scope.username = "";
        $scope.password = "";
        NotifierService.info('You have succeessfully signed out');
        return $location.path('/');
      });
    };
  });

}).call(this);

//# sourceMappingURL=LoginController.map
