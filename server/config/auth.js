// Generated by CoffeeScript 1.7.1
(function() {
  var passport;

  passport = require('passport');

  exports.authenticate = function(req, res, next) {
    var auth;
    req.body.username = req.body.username.toLowerCase();
    auth = passport.authenticate('local', function(err, user) {
      if (err) {
        return next(err);
      } else if (!user) {
        return res.send({
          success: false
        });
      } else {
        return req.logIn(user, function(err) {
          if (err) {
            return next(err);
          } else {
            return res.send({
              success: true,
              user: user
            });
          }
        });
      }
    });
    return auth(req, res, next);
  };

  exports.requireLogin = function(req, res, next) {
    if (!req.isAuthenticated()) {
      res.status(404);
      return res.end();
    } else {
      return next();
    }
  };

  exports.requireRole = function(role) {
    return function(req, res, next) {
      if (!(req.isAuthenticated() && req.user.roles.indexOf(role) > -1)) {
        res.status(404);
        return res.end();
      } else {
        return next();
      }
    };
  };

}).call(this);

//# sourceMappingURL=auth.map
